<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Excelデータをhtmlに変換します</title>
	<link rel="stylesheet" type="text/css" href="content/style.css">
	<link rel="stylesheet" type="text/css" href="content/normalize.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<!--	<script src="js/tabIndent.js"></script> -->
</head>
<body>
<div class="wrapper">
<h1>エクセルデータをhtmlに変換します</h1>
<h2>入力欄</h2>
<form>
	<input type="checkbox">
	<div><textarea name="tsvInput" class="tsvInput tabIndent" id="tsvInput"></textarea></div>
	<div class="btnConvert"><input type="button" name="btnConvert" value="htmlに変換する" onclick="btnClick()"></div>
</form>
<h2>出力欄</h2>
<div><textarea name="htmlOutput" class="htmlOutput"></textarea></div>
</div>
</body>
<script type="text/javascript"><!--
//ボタンクリック
function btnClick(){
	//配列に入れる
	var inputText = $("textarea[name='tsvInput']").val();
	//分ける
	tableArray = inputText.split("\n");

	// ２次元配列に入れる
	for(i=0; i<tableArray.length; i++){
		tableArray[i] = tableArray[i].split("\t");
	}

	// colspan処理
	for (var i = tableArray.length - 1; i >= 0; i--) {
		for (var j = tableArray[i].length - 1; j >= 0; j--) {
			if (tableArray[i][j] == "" && colspanArray[i][j] >= 1) {
				colspanArray[i][j-1] =+ colspanArray[i][j] + 1;
				colspanArray[i][j] = 0;
			};
			if (tableArray[i][j] == "" && colspanArray[i][j] == 0) {
				colspanArray[i][j-1] =+1;
			};
		};
	};
	// for (var i = 0; i < tableArray.length; i++) {
	// 	for (var j = 1; j < tableArray[i].length; j++) {
	// 		if(tableArray[i][j]=="") {
	// 			colspanArray[i][j-1]=+1;
	// 		};
	// 	};
	// };

	//配列を統合
	var text = "<table>\n";
	for (var i = 0; i < tableArray.length; i++) {

		// 最後が改行だけだったら抜ける処理（最後が改行なしでも消えないように対応）
		if (i==tableArray.length-1 && tableArray[i]=="") {break};

		text = text + "\t<tr>";
		for (j = 0; j < tableArray[i].length; j++) {
			if (j>0) {
				if (colspanArray[i][j]>0 && tableArray[i][j] != "") {
					text = text + '<td colspan="'+colspanArray[i][j]+'">'+tableArray[i][j]+'</td>';
				}else　if(colspanArray[i][j]==0 && tableArray[i][j] !=""){
					text = text + "<td>"+tableArray[i][j]+"</td>";
				};
			}else{
				text = text + "<td>"+tableArray[i][j]+"</td>";
			};
		};
		text = text + "</tr>\n";
	};
	text = text + "</table>";

	//配列を出力
	$("textarea[name='htmlOutput']").val(text);
}

// //タブインデント入力設定
// var el = document.getELementById('#tsvInput');
// tabIndent.render(el);

--></script>
</html>
